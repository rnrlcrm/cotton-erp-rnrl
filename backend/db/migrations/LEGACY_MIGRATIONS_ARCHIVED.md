# Legacy Migrations Archived (Baseline Reset 2025-12-02)

A clean reconciled baseline (`versions_clean/356fb34b6f4b_baseline_2025_12_02_clean.py`) was generated on 2025-12-02 to unify divergent/merged heads and remove speculative or conflicting migration history.

## Rationale
- Multiple merge heads and speculative revisions (performance indices, CDPS evolution, capability seeding) caused failed fresh upgrades and undefined columns.
- Duplicate partial partner schemas created inconsistent evolution paths.
- Goal: Establish a single authoritative schema matching current ORM models (canonical async stack, unified `BusinessPartner` model).

## Operator Guidance
Existing environments using the legacy chain must follow a data export + rebuild procedure:
1. Snapshot DB (pg_dump).
2. Provision fresh database.
3. Apply new baseline: `alembic upgrade head` (with `version_locations=versions_clean`).
4. Restore business data selectively (tables now aligned with unified models; omit deprecated columns).
5. Recreate necessary derived indexes if they existed outside ORM/autogenerated baseline.

## Deprecated Legacy Files (Removed)
```
001_outbox_add_event_outbox_table.py
002_capabilities_add_capability_tables.py
003_seed_capabilities.py
025fe632dacf_create_settings_locations_table.py
11c028f561fb_update_users_add_isolation_fields.py
18d3e2c1ff1d_create_commodity_master_tables.py
1ea89afdffb6_add_event_outbox_table.py
20251120_1400_create_organization_settings.py
20251123_072109_gdpr.py
20251125_add_availability_risk_fields.py
20251125_risk_validations.py
20251129112546_add_unit_conversion_test_reports_media.py
20251129114154_add_business_partner_indices.py
2025_12_01_add_eod_timezone_buyer_prefs.py
22989daa29de_your_change.py
32c4005785a7_next_change.py
400f038407b5_add_partner_triggers_and_indexes.py
4295209465ab_add_refresh_tokens.py
58286af88f2e_fix_schema_bugs_remove_organization_id_.py
59d2e1f64664_create_business_partners_table.py
5ac2637fb0dd_merge_migration_heads.py
6827270c0b0b_make_location_id_nullable_for_adhoc_.py
905a12a26853_merge_migration_heads.py
9a8b7c6d5e4f_add_user_sessions_table.py
9c041691742c_merge_risk_validations_with_other_.py
a6db02cd68b3_add_unit_conversion_fields_to_commodities.py
add_2fa_support.py
add_mobile_otp_fields.py
add_sub_user_support.py
b6d57334a17e_cdps_capability_driven_partner_system.py
bc14937b8b59_create_events_table.py
bdea096fec3e_add_hsn_knowledge_base_for_ai_learning_.py
cf052225ae84_create_partner_onboarding_tables.py
create_availability_engine_tables.py
create_requirement_engine_tables.py
e59a4a6de0ba_merge_migration_heads.py
eaf12a4e04a0_baseline.py
ebf8bb791693_merge_organization_and_refresh_token_.py
f1d199e8ab02_noop_check_after_fix.py
```
(The `__pycache__/` directory remains but is ignored.)

## Forward Plan
- All future revisions use `backend/db/migrations/versions_clean` only.
- Remove references to old revision IDs from documentation and planning artifacts.
- CI should validate fresh DB bootstrap with new baseline.

## Data Compatibility Notes
- Partner indices referencing `primary_state` removed (column absent in unified model).
- Capability-driven partner system (CDPS) will evolve via future discrete migrations starting from this baseline.
- Performance indexes for risk and availability will be reintroduced with measured profiling once workload stats are available.

## Safety
This archival affects only migration source files; production data remains untouched until operators perform the controlled baseline adoption procedure.

---
Maintainers: Update any infra scripts or runbooks pointing to legacy revision IDs.
